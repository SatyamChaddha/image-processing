% vim:ft=tex
% rubber: module xelatex
\subsection{Image segmentation}
\label{sec:segmentation}

We implemented two image segmentation algorithms: a simple thresholding algorithm, and a split and merge algorithm as described in the lecture slides. In both cases, the algorithm takes as input a greyscale image and outputs a segmented image. In the case of simple thresholding, the output image is divided into binary regions. In the case of the split and merge algorithm, the output image is divided into arbitrarily many regions, each one assigned a greyscale colour based on a rotating set of grey values.

\subsubsection{Implementation notes}

The 'global threshold' form of the thresholding algorithm takes the mean of all the pixel intensities in the image, and sorts each pixel as belonging to the background or the foreground based on this threshold. The 'adaptive threshold' option begins with the global threshold, then iteratively adjusts it to be halfway between the means of the current background and foreground, adjusting what qualifies as a background or foreground pixel accordingly until the threshold converges. This simple algorithm has a user parameter which sets whether the background in the original image is light or dark; no attempt is made to automatically determine this property.

The split and merge algorithm is a form of contextual segmentation. The image begins as a single region. In each iteration of the "split" step, every region is quartered into subregions. This process continues until all regions are uniform according to the uniformity predicate based on the value $\delta$. Then the "merge" step begins. In each iteration, adjacent regions are merged if the uniformity predicate would hold for the resulting superregion.

Typically, the behaviour of the "split" step would require input images with width and height powers of 2. This restriction is overcome by padding the edges with zero-intensity pixels to extend the image to the nearest power of 2. Regions made entirely of padding are then removed before the "merge" step. Regions made partly of padding are included in the "merge" step, but the resulting image is cropped back to its original parameters for the display.

In our implementation, the split and merge algorithm represents regions using the Region class. Unfortunately, in an attempt to be more efficient (by storing and processing fewer pixels), the Region class only stores the points of the regions' borders. The unforeseen downside of this is that the algorithm breaks down when non-convex regions exist. When the convexity assumption is broken, there are cases where regions that should have been merged escape the merging process, because certain pixels are included in checks that should not be. The result is that the segmentation process is less than perfect. The obvious solution to this implementation problem is to store all pixels which make up the region.

In the "merge" step of the split and merge segmentation, regions are compared to each other rather naively (i.e. every region is compared to every other region). This slows the implementation considerably when there are more than a few hundred regions after the split step (which occurs for low values of the delta parameter and for extremely heterogeneous images). The solution would be to only consider merging regions that are neighbouring; this is unfortunately impossible to do efficiently with the current region representation. Regions are merged using 4-connectivity, in as far as the algorithm checks, for each pixel on the boundary of a region, in four directions to determine whether the region can be merged.

\subsubsection{Experimental process.}

\paragraph{Experimental parameters.}
To test the capability of our segmenting algorithms, we...
(SUBJECTIVE TESTS OF ALL 3) - 20 randomly googled images, say which is best of the thresholding, try to correlate this with how much the adaptive threshold changed from the global, and say how split \& merge did (is it recognisable?)
(FOR TWO TINY TEST IMAGES TAKEN FROM OUR CALIBRATION PHOTOS: IDENTIFY NUMBER OF REGIONS; USE SPLIT/MERGE WITH VARIOUS PARAMS, SEE HOW MANY REGIONS IT RETURNS; GRAPH)

\paragraph{Experimental results.}
13, adaptive clearly better. Of these, for 10 of them the threshold was significantly different (>20 difference). 4, about the same. In all 4 cases, threshold was about the same (within 20). 3, global was better. These last two cases were:
 Complex image of a brightly-lit bridge, where the global threshold picked out some of the detail of the spars that adaptive did not
A cartoon imaeg where it picked out text in an intensity similar to the background of that text.
boat in waitomo caves, picked up glow-worms better and the other shrank the boat






